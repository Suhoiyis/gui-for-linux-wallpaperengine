# 更新日志

## v0.8.2 (2026-01-30)

### 新功能
- **命令复制**：在 "CURRENTLY USING" 旁边新增 📋 按钮，悬停显示当前运行的后端命令，点击复制到剪贴板

### UI 改进
- **系统标题栏支持**：使用 `Gtk.ApplicationWindow` 替代 `Adw.ApplicationWindow`，标题栏由窗口管理器绘制（GNOME/KDE 显示标题栏，niri/Hyprland 不显示）
- **屏幕选择器移至顶栏**：🖥 屏幕选择器从工具栏移至窗口左上角，与 Home/Settings 按钮同排

### Bug 修复
- **托盘随机切换修复**：修复了窗口隐藏时，使用托盘"随机切换壁纸"功能会意外唤出 GUI 窗口的问题

### 壁纸大小显示
- **侧边栏显示磁盘占用**：选中壁纸时，在 Folder ID 旁边显示壁纸文件夹的磁盘大小（如 "85.1 MB"）
- **绿色标签样式**：大小信息使用绿色胶囊标签，与蓝色的 Folder ID 形成对比

### 壁纸排序功能
- **工具栏排序控件**：新增 ⇅ 排序下拉菜单，支持 5 种排序方式
- **排序选项**：
  - Title - 按壁纸标题 A-Z 排序
  - Size ↓ - 按文件大小从大到小排序
  - Size ↑ - 按文件大小从小到大排序
  - Type - 按壁纸类型（Video/Scene/Web）排序
  - ID - 按文件夹 ID 排序（原默认方式）
- **配置持久化**：排序选项自动保存，重启后保持

---

## v0.8.1 (2026-01-25)

### 用户友好的错误反馈系统
- **Toast 通知系统**：新增 `Adw.ToastOverlay` 支持即时通知，用户无需查看日志即可了解问题
- **路径验证反馈**：设置页面保存时，如果 Workshop/Assets 路径无效，立即显示 Toast 提示
- **扫描错误检测**：壁纸扫描时检测路径不存在、目录为空、JSON 解析失败等问题，并提供友好提示
- **后端启动失败**：壁纸引擎启动失败时，自动显示错误提示，引导用户查看日志获取详细信息

### 新增 Assets 路径配置
- **自定义 Assets 目录**：在设置 > 高级中可手动指定 Wallpaper Engine assets 文件夹路径
- **Browse 按钮**：为 Workshop 和 Assets 路径都添加了文件夹浏览按钮，避免手动输入错误
- **路径验证**：保存设置时验证路径存在性，无效路径会自动清除配置并提示用户

---

## v0.8.0 (2026-01-24)

### 截图功能大修
- **真·静默截图**：智能检测并利用 `Xvfb` 实现无窗口后台截图（支持开关切换）
- **真·4K 采样**：强制后端以 3840x2160 分辨率渲染，完美解决平铺窗口管理器（如 Niri）下的画面裁切问题
- **交互闭环**：截图按钮实时状态反馈（📸 -> ⏳），成功后提供"打开图片/文件夹"快捷入口
- **智能策略**：针对视频壁纸启用极速模式（5帧），针对 Web 壁纸自适应延长等待时间

### 多显示器支持（Beta）
- **独立控制**：在主界面顶栏选择目标显示器，分别为不同屏幕设置不同壁纸
- **状态自愈**：启动时自动检测屏幕连接状态，智能清理已断开屏幕的配置，防止后端报错
- **全局管理**：托盘菜单的"随机播放"和"停止"操作会自动作用于所有活跃屏幕

### 自动化与体验升级
- **定时轮换**：支持按分钟间隔自动随机切换壁纸（支持多屏）
- **智能保存**：Settings 页面实现变更检测，修改非渲染参数（如自启、路径）时不再强制重启壁纸
- **系统集成**：一键生成桌面快捷方式 (`.desktop`) 和开机自启配置

### 高级渲染与音频控制
- **视觉管理**：新增禁用视差效果（Parallax）、禁用粒子系统（Particles）开关，以及纹理钳制（Clamping）模式选择
- **音频增强**：新增禁用自动静音（Auto Mute）、禁用音频处理逻辑（Audio Processing）开关

## v0.7.0 (早期版本)

### 系统托盘图标
- 基于 `libayatana-appindicator` 实现，完美支持 Wayland (Niri/Sway/Hyprland) + Waybar 环境

### 代码重构
- 将单文件脚本拆分为模块化包结构 (`py_GUI/`)，分离逻辑与界面
- 更名项目包为 `py_GUI`，新增启动脚本 `run_gui.py`

### 性能优化
- 改进了图片资源的加载与缓存机制

### 稳定性修复
- 修复了子进程输出导致的死锁问题，现在日志将重定向到文件而非管道

### UI 精简与交互优化
- **隐藏失效属性栏**：鉴于 C++ 后端在 Wayland 环境下的局限性（Web/Scene 属性无法生效），暂时禁用了侧边栏 Properties 编辑区，提升了界面整洁度并避免功能误导（代码已注释保留）
- **样式统一**：壁纸显示类型（Type）现在使用与标签一致的胶囊（Capsule）样式，视觉体验更统一

## v0.5.0

### 日志面板
- **实时日志显示**：应用和壁纸引擎的日志实时显示
- **日志级别**：支持 DEBUG/INFO/WARNING/ERROR 级别
- **日志来源**：区分 Controller/Engine/GUI 来源
- **日志管理**：Clear/Refresh 按钮，自动限制最大500条
- **等宽字体**：便于阅读日志内容
- **颜色区分**：不同日志级别使用不同颜色
- **一键复制**：Copy Logs 按钮可将日志内容复制到系统剪贴板

## v0.3.0

### 后台/CLI 控制
- **后台启动**：支持 `--hidden/--minimized` 启动参数，启动后仅后台运行，无窗口显示
- **单实例 CLI 控制**：所有命令行动作发往同一运行实例（复用 GTK 主线程，避免多开）
- **显示/隐藏窗口**：
  - `--show`：显示窗口（若已运行则展示）
  - `--hide`：隐藏窗口（进程保持）
  - `--toggle`：切换显示/隐藏状态
- **快捷操作**：
  - `--refresh`：重新扫描并加载壁纸库
  - `--apply-last`：直接应用上次保存的壁纸
  - `--quit`：完全退出应用与后台进程

### 搜索功能
- **实时搜索**：顶部搜索框支持按关键词实时过滤壁纸
- **多字段匹配**：搜索范围包括标题、描述、标签、文件夹名称

### 壁纸属性编辑（暂时禁用）
- **功能保留但已隐藏**：由于后端环境限制，目前在侧边栏已隐藏此区域。底层逻辑仍保留

## 早期版本功能

### 核心功能
- 壁纸浏览：从 Steam Workshop 自动扫描壁纸库
- 双视图模式：Grid（网格）与 List（列表）视图切换
- 侧边栏详情：显示壁纸大图、标题、类型、标签、描述
- 壁纸应用：点击 Apply 按钮或双击卡片直接应用壁纸
- 右键菜单：支持应用、停止、删除壁纸及打开所在文件夹
- 随机选择：I'm feeling lucky 随机应用一张壁纸
- 快速刷新：Refresh 按钮即时加载新下载的壁纸（无需重启）
- 自动应用：启动时自动应用上次壁纸

### 进程管理
- 后端调用：正确使用 `linux-wallpaperengine` 的参数格式
- 单实例控制：应用前自动 pkill 旧进程，避免堆叠
- 参数整数化：音量严格传递为整数字符串，防止浮点数崩溃

### UI/UX
- 现代深色主题：圆角、阴影、悬停效果
- 窗口约束：侧边栏固定 320px 宽度，不被图片撑宽
- 当前壁纸显示：顶部工具栏显示当前应用的壁纸名称
- 右键菜单优化：跟随鼠标位置弹出，支持点选或"按住-拖动-松手"的快速操作
- Stop 按钮：快速停止当前壁纸播放
- 后台保活窗口隐藏：关闭窗口会隐藏到后台（进程保留）
