# 🐛 常见后端日志与故障排查

本文档记录了 `linux-wallpaperengine` 后端常见的日志错误及其含义，帮助高级用户判断问题根源。

## 1. Wayland / OpenGL 相关

### 截图速度较慢 (5-10秒)
- **现象**：点击截图后，需要等待数秒才能弹出成功提示。
- **原因**：如果系统安装了 `xvfb`，程序会使用 **CPU 软件渲染** 来生成 4K 截图。这种方式虽然慢，但能保证：
  1. **无窗口弹出**：完全静默，不打扰工作。
  2. **完美 4K**：不受物理屏幕分辨率和平铺窗口管理器的限制。
- **建议**：这是正常现象，请耐心等待。

### 截图速度较慢 (5-10秒)
- **现象**：点击截图后，需要等待数秒才能弹出成功提示。
- **原因**：如果系统安装了 `xvfb`，程序会使用 **CPU 软件渲染** 来生成 4K 截图。这种方式虽然慢，但能保证：
  1. **无窗口弹出**：完全静默，不打扰工作。
  2. **完美 4K**：不受物理屏幕分辨率和平铺窗口管理器的限制。
- **建议**：这是正常现象，请耐心等待。

### `Failed to initialize GLEW: No GLX display`
- **现象**：
  1. 壁纸能运行，但部分特效（如粒子、音频波形）不可见。
  2. **Web 壁纸属性失效**：通过 GUI 或 CLI 设置属性（如 `language=chinese`）后，日志显示 `Applying override value`，但画面完全无变化。
- **原因**：后端硬编码依赖 X11 的 GLX 扩展。在纯 Wayland 环境下，OpenGL 环境初始化不完整，导致 Chromium (CEF) 的 JavaScript 注入接口（用于修改网页属性）静默失效。
- **影响**：
  - **Scene 类型**：复杂特效无法渲染。
  - **Web 类型**：**交互功能完全瘫痪**，无法动态调整任何壁纸属性。

## 2. Web 壁纸特有错误

### 日志显示 `Applying override value` 但界面没动
- **现象**：在终端运行 `linux-wallpaperengine <ID> --set-property key=value`，看到应用成功的日志，但壁纸依然显示默认状态。
- **根本原因**：
  1. **环境缺失**：参考上文的 `GLX display` 错误，渲染上下文异常导致后端无法通过 `ExecuteJavaScript` 与网页通信。
  2. **初始化时机**：部分壁纸将属性监听器注册在 `DOMContentLoaded` 事件中，而后端注入属性的时机过早，导致指令在网页准备好之前就已丢失。
  3. **SSL 报错**：日志中若出现 `handshake failed ... net_error -101`，说明网页依赖的外部资源（如 CDN 脚本）加载失败，可能阻塞了属性监听器的初始化。
## 3. 设置项环境限制

### `Disable Auto Mute` 无效
- **现象**：开启该功能后，其他应用播放声音时壁纸依然静音，或者该功能完全不起作用。
- **原因**：在 Wayland 环境下，受限于 PipeWire/Portal 的安全机制，后端进程可能无法检测到全局音频流的状态。

### `Disable Particles` 视觉无变化
- **原因**：如果壁纸本身由于 `GLX display` 错误已经无法渲染粒子系统，则此开关不会产生额外的视觉差异。
- **建议**：仅在粒子系统能正常显示的 X11 环境或兼容性较好的壁纸上进行测试。

### `Disable Parallax` 待验证
- **状态**：**尚未在带 3D 效果的 Scene 壁纸上进行完整测试。**
- **预期行为**：该开关应能停止背景随鼠标移动的视差晃动效果。

### `Clamping Mode` 的作用
- 用于解决非标准分辨率下的边缘拉伸问题。若壁纸显示正常，建议保持 `clamp` 默认值。

### `GLFW error 65548: Wayland: The platform does not support setting the window position`
- **现象**：日志中出现此错误。
- **原因**：GLFW 试图在 Wayland 下强制设置窗口坐标，但 Wayland 协议禁止客户端自定位置（由混成器管理）。
- **影响**：通常无害，但在某些情况下可能暗示窗口未能正确全屏或获取输入焦点。

## 2. 资源加载相关

### `Particle '...' max particles: ...` 但屏幕无显示
- **现象**：日志显示粒子系统已加载（如 `Particle 'Getsuga Tenshou Mouse Trail'...`），纹理也找到了，但屏幕上什么都没有。
- **原因**：
  1. **输入丢失**：粒子发射器依赖鼠标位置，但在 Wayland 下获取不到全局鼠标坐标 (0,0)，导致粒子从未发射。
  2. **渲染层级错误**：粒子被渲染到了背景图层之下（Z-fighting 或混合模式错误）。

### `Cannot find a valid assets folder`
- **现象**：启动失败，提示找不到 assets。
- **解决**：确保你已安装 Steam 版 Wallpaper Engine，或者手动将 `assets` 文件夹复制到 `linux-wallpaperengine` 同级目录。
